> 本章内容需要 iOS 16.4 及以上

# 准备工作

在 iOS 设备上打开系统设置，找到 Safari 浏览器、高级，开启网页检查器。

在 Mac 上打开 Safari，在设置中找到高级，开启 Develop 选项。

# 调试过程

将 iOS 设备连接至 Mac，运行脚本，打开 Mac 上的 Safari，在 Develop 菜单上找到您的设备名，选择相应的 JSContext 进行调试。

您将看到当前运行的代码，可以添加断点、单步执行。

---

## 文件内容解读与示例

### 用途说明：专业级远程调试

本文档介绍的是 JSBox 开发者工具链中一个非常强大且专业的组成部分：**利用 Mac 上的 Safari 浏览器进行 JSBox 脚本的远程调试**。这是一种比 `console.log` 更高级的调试手段，它允许你像调试网页一样，对运行在 iOS 设备上的 JSBox 脚本进行断点、单步执行、变量实时检查等操作。

### 核心概念：远程调试的工作原理

远程调试是指在一台设备（你的 Mac）上，通过专业的开发工具来控制和监控另一台设备（你的 iPhone/iPad）上运行的程序。对于 JSBox 而言，它会将脚本的 JavaScript 执行环境（`JSContext`）暴露给 Mac 上的 Safari 浏览器。一旦连接成功，Safari 的“网页检查器”就能够像调试网页一样，完全控制和观察 JSBox 脚本的执行。

通过远程调试，你将获得以下关键能力：

-   **断点 (Breakpoints)**: 在代码的任意行设置暂停点，程序执行到此处会自动暂停。
-   **单步执行 (Step-by-step Execution)**: 代码暂停后，你可以控制它一行一行地执行，观察每一步的变量变化和逻辑走向。
-   **变量实时检查**: 在程序暂停时，你可以查看当前作用域内所有变量的实时值，包括复杂对象和数组。
-   **调用堆栈 (Call Stack)**: 查看函数调用的层级关系，帮助你理解代码是如何执行到当前位置的。
-   **实时控制台**: 在 Safari 的控制台中输入 JavaScript 代码，并立即在 iOS 设备上运行的脚本环境中执行，这对于动态测试和修改非常有用。

### 准备工作 (一次性设置)

为了能够进行远程调试，你需要进行以下设置：

1.  **在你的 iOS 设备上**：
    -   打开 `设置` 应用。
    -   滚动并点击 `Safari 浏览器`。
    -   滚动到最底部，点击 `高级`。
    -   确保 `网页检查器` 的开关是**打开**状态。

2.  **在你的 Mac 上**：
    -   打开 `Safari` 浏览器。
    -   点击屏幕左上角的 `Safari` 菜单，选择 `设置...` (或 `偏好设置...`)。
    -   在弹出的窗口中，切换到 `高级` 标签页。
    -   勾选底部的 `在菜单栏中显示“开发”菜单` 选项。

完成以上步骤后，你会在 Mac Safari 的菜单栏中看到一个新的 `开发` 选项。

### 调试过程 (每次调试时)

1.  **连接设备**: 使用 USB 数据线将你的 iPhone 或 iPad 连接到 Mac。
2.  **运行脚本**: 在 iOS 设备上打开 JSBox，并运行你想要调试的脚本。
3.  **打开 Safari 网页检查器**:
    -   在 Mac 上，点击 Safari 菜单栏中的 `开发`。
    -   在下拉菜单中，你会看到你的 iOS 设备名称（例如“我的 iPhone”）。
    -   将鼠标悬停在你的设备名称上，会展开一个子菜单，其中列出了当前可调试的 JavaScript 环境。找到并点击与你的 JSBox 脚本相关的项（通常会显示脚本的名称或“JSBox”）。

4.  **开始调试**: Safari 会弹出一个新的“网页检查器”窗口。你将看到熟悉的开发者工具界面，其中“来源”（Sources）标签页会显示你的 JSBox 脚本代码。

### 示例：使用断点调试循环

假设你有一个计算阶乘的函数，但你怀疑它在某个环节出了问题：

```javascript
function factorial(n) {
  if (n < 0) {
    console.error("输入不能为负数");
    return -1;
  }
  let result = 1;
  for (let i = 1; i <= n; i++) {
    result *= i; // 假设这里可能出错
  }
  return result;
}

console.log("5 的阶乘是:", factorial(5));
```

**调试步骤**：

1.  **设置断点**: 在 Mac Safari 的网页检查器中，找到 `result *= i;` 这一行代码。点击行号左侧的空白区域，会出现一个蓝色标记，表示断点已设置。
2.  **重新运行脚本**: 回到 iOS 设备上的 JSBox，重新运行 `factorial` 脚本。
3.  **代码暂停**: 当脚本执行到 `result *= i;` 这一行时，它会自动暂停。此时，Safari 的网页检查器窗口会被激活并显示当前暂停的位置。
4.  **检查变量**: 在网页检查器右侧的“作用域”（Scope）面板中，你可以实时查看 `n`, `result`, `i` 等变量的当前值。
5.  **单步执行**: 使用检查器工具栏上的“单步跳过”（Step Over）按钮（通常是一个越过一条线的箭头），你可以让代码一行一行地执行。每点击一次，代码就执行一步并再次暂停，你可以观察 `result` 和 `i` 的值是如何随着循环的进行而变化的。

通过这种方式，你可以精确地追踪代码的执行路径，观察变量的实时状态，从而高效地定位和解决问题，这比简单地插入 `console.log` 语句要强大和直观得多。