# Action Extension 上的扩展

`Action Extension` 是指 iOS 分享面板下面那一排图标，JSBox 的扩展支持从这里启动，从这里启动扩展通常是因为用户触发了一个分享操作，所以我们可以取到用户传递过来的分享内容。

# Action Extension 上面限制

与 Widget 类似的是，Action Extension 同样有些限制，虽然限制没有 Widget 那么多。

目前而言，限制主要有两点：

- 可用内存较小，当扩展使用过大的内存时，系统会强制关闭掉这个扩展
- 在 Action Extension 里面无法拍照，即无法使用 `$photo.pick` 接口

# $context

我们通过 `$context` 这个对象来封装来自外部的参数，Action Extension 里面表现为用户分享的内容。具体方法请见[方法列表](context/method.md)

---

## 文件内容解读与示例

### 核心概念：运行上下文 (Execution Context)

本文档介绍了 JSBox 的一个基石概念：**运行上下文**。简单来说，同一个 JSBox 脚本可以在 iOS 系统的多个不同地方被触发和运行，而“上下文”就是用来描述“脚本当前是在哪里运行的”以及“它从外部接收到了什么输入数据”。

我们可以用一个比喻来理解：

> 假设你的脚本是一个工具箱。你可以在不同的场景（上下文）下使用它：
> - **在主应用中运行**: 这是你的“主工作室”。你直接在 JSBox 应用里点击脚本的“运行”按钮。在这里，你的工具箱功能最全，资源（内存、API权限）最丰富。
> - **在分享扩展 (Action Extension) 中运行**: 这是你的“收货码头”。当你在其他应用（如相册、Safari）中点击“分享”按钮，并选择你的脚本时，它就在这个上下文中运行。它的核心任务是接收和处理分享过来的“货物”（如图片、链接、文本）。
> - **在今日小组件 (Today Widget) 中运行**: 这是你的“展示橱窗”。脚本在通知中心或主屏幕负一屏运行，主要任务是快速展示信息。这里的场地最小，限制也最严格。
> - **在键盘 (Keyboard) 中运行**: 这是你的“打字助手”。脚本作为一个自定义键盘来运行，帮助你输入预设内容或进行文本处理。

### `Action Extension` 上下文详解

本文档主要聚焦于 **Action Extension** 这个上下文。

- **触发方式**: 用户在任意 App（如“照片”）中，选中一张图片，点击“分享”图标，然后在弹出的分享列表中找到并点击你的脚本图标。
- **`$context` 对象的作用**: `$context` 是连接外部 App 和你的脚本的**桥梁**。当脚本在 Action Extension 中运行时，`$context` 对象会被自动填充上分享过来的数据。例如：
  - 如果分享的是图片，`$context.image` 或 `$context.images` 就会有值。
  - 如果分享的是一个网址，`$context.link` 或 `$context.links` 就会有值。
  - 如果分享的是纯文本，`$context.text` 就会有值。
  你的脚本可以通过检查 `$context` 的这些属性，来得知自己收到了什么，并进行相应的处理。

- **限制**: 正如文档所说，由于 iOS 系统为扩展分配的资源比主应用少，Action Extension 会有更严格的内存限制，并且某些 API（如 `$photo.pick`）无法使用。这是为了保证系统整体的流畅和稳定。

### 概念示例：一个“云盘上传”脚本

让我们构思一个名为“上传到我的云盘”的脚本，它无需任何代码，只需理解其在不同上下文中的行为即可：

- **当在主应用中运行时**: 
  脚本启动后，发现 `$context` 中没有任何外部传入的数据。于是，它会调用 `$drive.open()` 或 `$photo.pick()`，弹出一个文件选择器，让用户**主动选择**一个文件来上传。

- **当作为 Action Extension 运行时**:
  1.  你在“文件”App 中找到了一个 PDF 文档。
  2.  你点击“分享”，然后选择“上传到我的云盘”这个脚本。
  3.  脚本启动，它首先检查 `$context.data`，发现里面有刚刚分享过来的 PDF 文件数据。
  4.  于是，脚本**跳过**了文件选择的步骤，直接拿着这份数据执行上传操作。

通过这个例子，我们可以看到，同一个脚本通过判断 `$context` 的内容，实现了在不同上下文中的智能化行为。要了解 `$context` 到底有哪些属性，你需要查阅下一篇文档 `method.md`。 
